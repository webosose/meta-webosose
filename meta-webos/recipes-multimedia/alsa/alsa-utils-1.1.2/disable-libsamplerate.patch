From 457c3160185d620ae95aa9b07ecf00cabee76e4e Mon Sep 17 00:00:00 2001
From: Martin Jansa <Martin.Jansa@gmail.com>
Date: Thu, 18 Feb 2016 12:43:22 +0100
Subject: [PATCH] configure.ac: add parameters to enable/disable libsamplerate
 support

* we don't like the autodetection

Signed-off-by: Martin Jansa <Martin.Jansa@gmail.com>
---
 configure.ac | 18 +++++++++++++++---
 1 file changed, 15 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index bdb133c..c7bef67 100644
--- a/configure.ac
+++ b/configure.ac
@@ -38,8 +38,6 @@ AC_CHECK_HEADERS([alsa/use-case.h], [have_ucm="yes"], [have_ucm="no"],
   [#include <alsa/asoundlib.h>])
 AC_CHECK_HEADERS([alsa/topology.h], [have_topology="yes"], [have_topology="no"],
   [#include <alsa/asoundlib.h>])
-AC_CHECK_HEADERS([samplerate.h], [have_samplerate="yes"], [have_samplerate="no"],
-  [#include <samplerate.h>])
 
 AM_CONDITIONAL(HAVE_PCM, test "$have_pcm" = "yes")
 AM_CONDITIONAL(HAVE_MIXER, test "$have_mixer" = "yes")
@@ -47,7 +45,21 @@ AM_CONDITIONAL(HAVE_RAWMIDI, test "$have_rawmidi" = "yes")
 AM_CONDITIONAL(HAVE_SEQ, test "$have_seq" = "yes")
 AM_CONDITIONAL(HAVE_UCM, test "$have_ucm" = "yes")
 AM_CONDITIONAL(HAVE_TOPOLOGY, test "$have_topology" = "yes")
-AM_CONDITIONAL(HAVE_SAMPLERATE, test "$have_samplerate" = "yes")
+
+libsamplerate=
+AC_ARG_ENABLE(libsamplerate,
+     AS_HELP_STRING([--disable-libsamplerate], [Disable libsamplerate usage]),
+     [case "${enableval}" in
+       yes) libsamplerate=true ;;
+       no)  libsamplerate=false ;;
+       *) AC_MSG_ERROR(bad value ${enableval} for --enable-libsamplerate) ;;
+     esac],[libsamplerate=true])
+
+if test "$libsamplerate" = "true"; then
+AC_CHECK_HEADERS([samplerate.h], [have_samplerate="yes"], [have_samplerate="no"],
+  [#include <samplerate.h>])
+fi
+AM_CONDITIONAL(HAVE_SAMPLERATE, test $have_samplerate = "yes")
 
 dnl Disable bat
 bat=
-- 
2.7.1

